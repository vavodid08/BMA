(function(q){q.fn.jqm=function(a){var c=q.extend({},q.jqm.params,a);return this.each(function(){var e=q(this),f=e.data("jqm");if(!f){f={ID:v++}}e.data("jqm",q.extend(f,c)).addClass("jqm-init");c.trigger&&q(this).jqmAddTrigger(c.trigger)})};q.fn.jqmAddTrigger=function(a){return this.each(function(){if(!d(q(this),"jqmShow",a)){y("jqmAddTrigger must be called on initialized modals")}})};q.fn.jqmAddClose=function(a){return this.each(function(){if(!d(q(this),"jqmHide",a)){y("jqmAddClose must be called on initialized modals")}})};q.fn.jqmShow=function(a){return this.each(function(){!this._jqmShown&&g(q(this),a)})};q.fn.jqmHide=function(a){return this.each(function(){this._jqmShown&&b(q(this),a)})};var y=function(a){if(window.console&&window.console.error){window.console.error(a)}},g=function(h,C){var u=h.data("jqm"),C=C||window.event,e=parseInt(h.css("z-index")),e=e>0?e:3000,l=q("<div></div>").addClass(u.overlayClass).css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":e-1}),B={w:h,c:u,o:l,t:C};h.css("z-index",e);if(u.ajax){var c=u.target||h,A=u.ajax;c=typeof c=="string"?q(c,h):q(c);if(A.substr(0,1)=="@"){A=q(C).attr(A.substring(1))}c.html(u.ajaxText).load(A,function(){u.onLoad&&u.onLoad.call(this,B);x(B)})}else{x(B)}},b=function(f,a){var h=f.data("jqm"),a=a||window.event,c={w:f,c:h,o:f.data("jqmv"),t:a};w(c)},k=function(a){if(a.c.overlay>0){a.o.prependTo("body")}a.w.show();q.jqm.focusFunc(a.w);return true},z=function(a){a.w.hide()&&a.o&&a.o.remove();return true},d=function(a,e,c){if(!a.data("jqm")){return false}return q(c).each(function(){this[e]=this[e]||[];this[e].push(a)}).click(function(){var f=this;q.each(this[e],function(i,h){h[e](f)});return false})},x=function(c){var f=c.w,e=c.o,a=c.c;if(a.onShow(c)!==false){f[0]._jqmShown=true;if(a.modal){!m[0]&&p("bind");m.push(f)}else{f.jqmAddClose(e)}a.closeClass&&f.jqmAddClose(q("."+a.closeClass,f));a.toTop&&e&&f.before('<span id="jqmP'+a.ID+'"></span>').insertAfter(e);f.data("jqmv",e)}},w=function(c){var f=c.w,e=c.o,a=c.c;if(a.onHide(c)!==false){f[0]._jqmShown=false;if(a.modal){m.pop();!m[0]&&p("unbind")}a.toTop&&e&&q("#jqmP"+a.ID).after(f).remove()}},p=function(a){q(document)[a]("keypress keydown mousedown",j)},j=function(a){var e=q(a.target).data("jqm")||q(a.target).parents(".jqm-init:first").data("jqm"),c=m[m.length-1].data("jqm");if(e&&e.ID==c.ID){return true}return q.jqm.focusFunc(c)},v=0,m=[];q.jqm={params:{overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:false,target:false,ajaxText:"",modal:false,toTop:false,onShow:k,onHide:z,onLoad:false},focusFunc:function(a){q(":input:visible:first",a).focus();return false}}})(jQuery);