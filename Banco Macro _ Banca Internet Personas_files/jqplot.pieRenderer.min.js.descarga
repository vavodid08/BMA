(function(x){x.jqplot.PieRenderer=function(){x.jqplot.LineRenderer.call(this)};x.jqplot.PieRenderer.prototype=new x.jqplot.LineRenderer();x.jqplot.PieRenderer.prototype.constructor=x.jqplot.PieRenderer;x.jqplot.PieRenderer.prototype.init=function(e,a){this.diameter=null;this.padding=20;this.sliceMargin=0;this.fill=true;this.shadowOffset=2;this.shadowAlpha=0.07;this.shadowDepth=5;this.highlightMouseOver=true;this.highlightMouseDown=false;this.highlightColors=[];this.dataLabels="percent";this.showDataLabels=false;this.dataLabelFormatString=null;this.dataLabelThreshold=3;this.dataLabelPositionFactor=0.52;this.dataLabelNudge=2;this.dataLabelCenterOn=true;this.startAngle=0;this.tickRenderer=x.jqplot.PieTickRenderer;this._drawData=true;this._type="pie";if(e.highlightMouseDown&&e.highlightMouseOver==null){e.highlightMouseOver=false}x.extend(true,this,e);if(this.sliceMargin<0){this.sliceMargin=0}this._diameter=null;this._radius=null;this._sliceAngles=[];this._highlightedPoint=null;if(this.highlightColors.length==0){for(var c=0;c<this.seriesColors.length;c++){var d=x.jqplot.getColorComponents(this.seriesColors[c]);var g=[d[0],d[1],d[2]];var b=g[0]+g[1]+g[2];for(var f=0;f<3;f++){g[f]=(b>570)?g[f]*0.8:g[f]+0.3*(255-g[f]);g[f]=parseInt(g[f],10)}this.highlightColors.push("rgb("+g[0]+","+g[1]+","+g[2]+")")}}this.highlightColorGenerator=new x.jqplot.ColorGenerator(this.highlightColors);a.postParseOptionsHooks.addOnce(p);a.postInitHooks.addOnce(v);a.eventListenerHooks.addOnce("jqplotMouseMove",A);a.eventListenerHooks.addOnce("jqplotMouseDown",B);a.eventListenerHooks.addOnce("jqplotMouseUp",q);a.eventListenerHooks.addOnce("jqplotClick",w);a.eventListenerHooks.addOnce("jqplotRightClick",o);a.postDrawHooks.addOnce(t)};x.jqplot.PieRenderer.prototype.setGridData=function(b){var f=[];var a=[];var g=this.startAngle/180*Math.PI;var c=0;this._drawData=false;for(var d=0;d<this.data.length;d++){if(this.data[d][1]!=0){this._drawData=true}f.push(this.data[d][1]);a.push([this.data[d][0]]);if(d>0){f[d]+=f[d-1]}c+=this.data[d][1]}var e=Math.PI*2/f[f.length-1];for(var d=0;d<f.length;d++){a[d][1]=f[d]*e;a[d][2]=this.data[d][1]/c}this.gridData=a};x.jqplot.PieRenderer.prototype.makeGridData=function(c,b){var g=[];var a=[];var d=0;var h=this.startAngle/180*Math.PI;this._drawData=false;for(var e=0;e<c.length;e++){if(this.data[e][1]!=0){this._drawData=true}g.push(c[e][1]);a.push([c[e][0]]);if(e>0){g[e]+=g[e-1]}d+=c[e][1]}var f=Math.PI*2/g[g.length-1];for(var e=0;e<g.length;e++){a[e][1]=g[e]*f;a[e][2]=c[e][1]/d}return a};function u(a){return Math.sin((a-(a-Math.PI)/8/Math.PI)/2)}function s(g,h,d,f,a){var e=0;var b=h-g;var i=Math.abs(b);var c=d;if(f==false){c+=a}if(c>0&&i>0.01&&i<6.282){e=parseFloat(c)/2/u(b)}return e}x.jqplot.PieRenderer.prototype.drawSlice=function(d,h,i,m,k){if(this._drawData){var e=this._radius;var g=this.fill;var j=this.lineWidth;var E=this.sliceMargin;if(this.fill==false){E+=this.lineWidth}d.save();d.translate(this._center[0],this._center[1]);var a=s(h,i,this.sliceMargin,this.fill,this.lineWidth);var f=a*Math.cos((h+i)/2);var c=a*Math.sin((h+i)/2);if((i-h)<=Math.PI){e-=a}else{e+=a}d.translate(f,c);if(k){for(var l=0,n=this.shadowDepth;l<n;l++){d.save();d.translate(this.shadowOffset*Math.cos(this.shadowAngle/180*Math.PI),this.shadowOffset*Math.sin(this.shadowAngle/180*Math.PI));b(e)}for(var l=0,n=this.shadowDepth;l<n;l++){d.restore()}}else{b(e)}d.restore()}function b(C){if(i>6.282+this.startAngle){i=6.282+this.startAngle;if(h>i){h=6.281+this.startAngle}}if(h>=i){return}d.beginPath();d.fillStyle=m;d.strokeStyle=m;d.lineWidth=j;d.arc(0,0,C,h,i,false);d.lineTo(0,0);d.closePath();if(g){d.fill()}else{d.stroke()}}};x.jqplot.PieRenderer.prototype.draw=function(am,aq,aj,ay){var d;var ag=(aj!=undefined)?aj:{};var au=0;var av=0;var m=1;var ac=new x.jqplot.ColorGenerator(this.seriesColors);if(aj.legendInfo&&aj.legendInfo.placement=="insideGrid"){var ae=aj.legendInfo;switch(ae.location){case"nw":au=ae.width+ae.xoffset;break;case"w":au=ae.width+ae.xoffset;break;case"sw":au=ae.width+ae.xoffset;break;case"ne":au=ae.width+ae.xoffset;m=-1;break;case"e":au=ae.width+ae.xoffset;m=-1;break;case"se":au=ae.width+ae.xoffset;m=-1;break;case"n":av=ae.height+ae.yoffset;break;case"s":av=ae.height+ae.yoffset;m=-1;break;default:break}}var ad=(ag.shadow!=undefined)?ag.shadow:this.shadow;var ao=(ag.fill!=undefined)?ag.fill:this.fill;var al=am.canvas.width;var af=am.canvas.height;var j=al-au-2*this.padding;var c=af-av-2*this.padding;var n=Math.min(j,c);var b=n;this._sliceAngles=[];var ar=this.sliceMargin;if(this.fill==false){ar+=this.lineWidth}var aw;var ah=0;var i,ap,a,an;var ak=this.startAngle/180*Math.PI;for(var d=0,e=aq.length;d<e;d++){ap=(d==0)?ak:aq[d-1][1]+ak;a=aq[d][1]+ak;this._sliceAngles.push([ap,a]);aw=s(ap,a,this.sliceMargin,this.fill,this.lineWidth);if(Math.abs(a-ap)>Math.PI){ah=Math.max(aw,ah)}}if(this.diameter!=null&&this.diameter>0){this._diameter=this.diameter-2*ah}else{this._diameter=b-2*ah}if(this._diameter<6){x.jqplot.log("Diameter of pie too small, not rendering.");return}var h=this._radius=this._diameter/2;this._center=[(al-m*au)/2+m*au+ah*Math.cos(ak),(af-m*av)/2+m*av+ah*Math.sin(ak)];if(this.shadow){for(var d=0,e=aq.length;d<e;d++){an="rgba(0,0,0,"+this.shadowAlpha+")";this.renderer.drawSlice.call(this,am,this._sliceAngles[d][0],this._sliceAngles[d][1],an,true)}}for(var d=0;d<aq.length;d++){this.renderer.drawSlice.call(this,am,this._sliceAngles[d][0],this._sliceAngles[d][1],ac.next(),false);if(this.showDataLabels&&aq[d][2]*100>=this.dataLabelThreshold){var ai,f=(this._sliceAngles[d][0]+this._sliceAngles[d][1])/2,g;if(this.dataLabels=="label"){ai=this.dataLabelFormatString||"%s";g=x.jqplot.sprintf(ai,aq[d][0])}else{if(this.dataLabels=="value"){ai=this.dataLabelFormatString||"%d";g=x.jqplot.sprintf(ai,this.data[d][1])}else{if(this.dataLabels=="percent"){ai=this.dataLabelFormatString||"%d%%";g=x.jqplot.sprintf(ai,aq[d][2]*100)}else{if(this.dataLabels.constructor==Array){ai=this.dataLabelFormatString||"%s";g=x.jqplot.sprintf(ai,this.dataLabels[d])}}}}var ax=(this._radius)*this.dataLabelPositionFactor+this.sliceMargin+this.dataLabelNudge;var k=this._center[0]+Math.cos(f)*ax+this.canvas._offsets.left;var l=this._center[1]+Math.sin(f)*ax+this.canvas._offsets.top;var at=x('<div class="jqplot-pie-series jqplot-data-label" style="position:absolute;">'+g+"</div>").insertBefore(ay.eventCanvas._elem);if(this.dataLabelCenterOn){k-=at.width()/2;l-=at.height()/2}else{k-=at.width()*Math.sin(f/2);l-=at.height()/2}k=Math.round(k);l=Math.round(l);at.css({left:k,top:l})}}};x.jqplot.PieAxisRenderer=function(){x.jqplot.LinearAxisRenderer.call(this)};x.jqplot.PieAxisRenderer.prototype=new x.jqplot.LinearAxisRenderer();x.jqplot.PieAxisRenderer.prototype.constructor=x.jqplot.PieAxisRenderer;x.jqplot.PieAxisRenderer.prototype.init=function(a){this.tickRenderer=x.jqplot.PieTickRenderer;x.extend(true,this,a);this._dataBounds={min:0,max:100};this.min=0;this.max=100;this.showTicks=false;this.ticks=[];this.showMark=false;this.show=false};x.jqplot.PieLegendRenderer=function(){x.jqplot.TableLegendRenderer.call(this)};x.jqplot.PieLegendRenderer.prototype=new x.jqplot.TableLegendRenderer();x.jqplot.PieLegendRenderer.prototype.constructor=x.jqplot.PieLegendRenderer;x.jqplot.PieLegendRenderer.prototype.init=function(a){this.numberRows=null;this.numberColumns=null;x.extend(true,this,a)};x.jqplot.PieLegendRenderer.prototype.draw=function(){var L=this;if(this.show){var M=this._series;this._elem=x(document.createElement("table"));this._elem.addClass("jqplot-table-legend");var m={position:"absolute"};if(this.background){m.background=this.background}if(this.border){m.border=this.border}if(this.fontSize){m.fontSize=this.fontSize}if(this.fontFamily){m.fontFamily=this.fontFamily}if(this.textColor){m.textColor=this.textColor}if(this.marginTop!=null){m.marginTop=this.marginTop}if(this.marginBottom!=null){m.marginBottom=this.marginBottom}if(this.marginLeft!=null){m.marginLeft=this.marginLeft}if(this.marginRight!=null){m.marginRight=this.marginRight}this._elem.css(m);var d=false,O=false,Q,c;var K=M[0];var P=new x.jqplot.ColorGenerator(K.seriesColors);if(K.show){var b=K.data;if(this.numberRows){Q=this.numberRows;if(!this.numberColumns){c=Math.ceil(b.length/Q)}else{c=this.numberColumns}}else{if(this.numberColumns){c=this.numberColumns;Q=Math.ceil(b.length/this.numberColumns)}else{Q=b.length;c=1}}var f,h;var N,g,i;var e,a,k;var n=0;var j,l;for(f=0;f<Q;f++){N=x(document.createElement("tr"));N.addClass("jqplot-table-legend");if(O){N.prependTo(this._elem)}else{N.appendTo(this._elem)}for(h=0;h<c;h++){if(n<b.length){e=this.labels[n]||b[n][0].toString();k=P.next();if(!O){if(f>0){d=true}else{d=false}}else{if(f==Q-1){d=false}else{d=true}}a=(d)?this.rowSpacing:"0";g=x(document.createElement("td"));g.addClass("jqplot-table-legend jqplot-table-legend-swatch");g.css({textAlign:"center",paddingTop:a});j=x(document.createElement("div"));j.addClass("jqplot-table-legend-swatch-outline");l=x(document.createElement("div"));l.addClass("jqplot-table-legend-swatch");l.css({backgroundColor:k,borderColor:k});g.append(j.append(l));i=x(document.createElement("td"));i.addClass("jqplot-table-legend jqplot-table-legend-label");i.css("paddingTop",a);if(this.escapeHtml){i.text(e)}else{i.html(e)}if(O){i.prependTo(N);g.prependTo(N)}else{g.appendTo(N);i.appendTo(N)}d=true}n++}}}}return this._elem};x.jqplot.PieRenderer.prototype.handleMove=function(d,e,a,b,c){if(b){var f=[b.seriesIndex,b.pointIndex,b.data];c.target.trigger("jqplotDataMouseOver",f);if(c.series[f[0]].highlightMouseOver&&!(f[0]==c.plugins.pieRenderer.highlightedSeriesIndex&&f[1]==c.series[f[0]]._highlightedPoint)){c.target.trigger("jqplotDataHighlight",f);y(c,f[0],f[1])}}else{if(b==null){r(c)}}};function z(a,b,d){d=d||{};d.axesDefaults=d.axesDefaults||{};d.legend=d.legend||{};d.seriesDefaults=d.seriesDefaults||{};var e=false;if(d.seriesDefaults.renderer==x.jqplot.PieRenderer){e=true}else{if(d.series){for(var c=0;c<d.series.length;c++){if(d.series[c].renderer==x.jqplot.PieRenderer){e=true}}}}if(e){d.axesDefaults.renderer=x.jqplot.PieAxisRenderer;d.legend.renderer=x.jqplot.PieLegendRenderer;d.legend.preDraw=true;d.seriesDefaults.pointLabels={show:false}}}function v(a,b,d){for(var c=0;c<this.series.length;c++){if(this.series[c].renderer.constructor==x.jqplot.PieRenderer){if(this.series[c].highlightMouseOver){this.series[c].highlightMouseDown=false}}}}function p(b){for(var a=0;a<this.series.length;a++){this.series[a].seriesColors=this.seriesColors;this.series[a].colorGenerator=x.jqplot.colorGenerator}}function y(a,b,c){var d=a.series[b];var e=a.plugins.pieRenderer.highlightCanvas;e._ctx.clearRect(0,0,e._ctx.canvas.width,e._ctx.canvas.height);d._highlightedPoint=c;a.plugins.pieRenderer.highlightedSeriesIndex=b;d.renderer.drawSlice.call(d,e._ctx,d._sliceAngles[c][0],d._sliceAngles[c][1],d.highlightColorGenerator.get(c),false)}function r(a){var c=a.plugins.pieRenderer.highlightCanvas;c._ctx.clearRect(0,0,c._ctx.canvas.width,c._ctx.canvas.height);for(var b=0;b<a.series.length;b++){a.series[b]._highlightedPoint=null}a.plugins.pieRenderer.highlightedSeriesIndex=null;a.target.trigger("jqplotDataUnhighlight")}function A(d,e,a,b,c){if(b){var f=[b.seriesIndex,b.pointIndex,b.data];var g=jQuery.Event("jqplotDataMouseOver");g.pageX=d.pageX;g.pageY=d.pageY;c.target.trigger(g,f);if(c.series[f[0]].highlightMouseOver&&!(f[0]==c.plugins.pieRenderer.highlightedSeriesIndex&&f[1]==c.series[f[0]]._highlightedPoint)){var h=jQuery.Event("jqplotDataHighlight");h.which=d.which;h.pageX=d.pageX;h.pageY=d.pageY;c.target.trigger(h,f);y(c,f[0],f[1])}}else{if(b==null){r(c)}}}function B(d,e,a,b,c){if(b){var f=[b.seriesIndex,b.pointIndex,b.data];if(c.series[f[0]].highlightMouseDown&&!(f[0]==c.plugins.pieRenderer.highlightedSeriesIndex&&f[1]==c.series[f[0]]._highlightedPoint)){var g=jQuery.Event("jqplotDataHighlight");g.which=d.which;g.pageX=d.pageX;g.pageY=d.pageY;c.target.trigger(g,f);y(c,f[0],f[1])}}else{if(b==null){r(c)}}}function q(d,e,a,b,c){var f=c.plugins.pieRenderer.highlightedSeriesIndex;if(f!=null&&c.series[f].highlightMouseDown){r(c)}}function w(d,e,a,b,c){if(b){var f=[b.seriesIndex,b.pointIndex,b.data];var g=jQuery.Event("jqplotDataClick");g.which=d.which;g.pageX=d.pageX;g.pageY=d.pageY;c.target.trigger(g,f)}}function o(d,e,a,b,c){if(b){var f=[b.seriesIndex,b.pointIndex,b.data];var h=c.plugins.pieRenderer.highlightedSeriesIndex;if(h!=null&&c.series[h].highlightMouseDown){r(c)}var g=jQuery.Event("jqplotDataRightClick");g.which=d.which;g.pageX=d.pageX;g.pageY=d.pageY;c.target.trigger(g,f)}}function t(){if(this.plugins.pieRenderer&&this.plugins.pieRenderer.highlightCanvas){this.plugins.pieRenderer.highlightCanvas.resetCanvas();this.plugins.pieRenderer.highlightCanvas=null}this.plugins.pieRenderer={highlightedSeriesIndex:null};this.plugins.pieRenderer.highlightCanvas=new x.jqplot.GenericCanvas();var a=x(this.targetId+" .jqplot-data-label");if(a.length){x(a[0]).before(this.plugins.pieRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-pieRenderer-highlight-canvas",this._plotDimensions,this))}else{this.eventCanvas._elem.before(this.plugins.pieRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-pieRenderer-highlight-canvas",this._plotDimensions,this))}var b=this.plugins.pieRenderer.highlightCanvas.setContext();this.eventCanvas._elem.bind("mouseleave",{plot:this},function(c){r(c.data.plot)})}x.jqplot.preInitHooks.push(z);x.jqplot.PieTickRenderer=function(){x.jqplot.AxisTickRenderer.call(this)};x.jqplot.PieTickRenderer.prototype=new x.jqplot.AxisTickRenderer();x.jqplot.PieTickRenderer.prototype.constructor=x.jqplot.PieTickRenderer})(jQuery);